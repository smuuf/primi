#!/bin/bash -e

cd $(dirname $0)

function info {
	echo "█ "$1
}

function header {
	echo -e "${CLR_GREEN}▄${CLR_RESET}"
	echo -e "${CLR_GREEN}█${CLR_RESET} $1"
	echo -e "${CLR_GREEN}▀${CLR_RESET}"
}

INTERPRETER=$([[ ! -z "$2" ]] && echo "$2" || echo "php")

# If the interpreter is phpdbg, we need to add "-qrr" arguments to actually
# run the files.
# https://www.php.net/manual/en/intro.phpdbg.php
if [[ "$INTERPRETER" =~ 'phpdbg' ]]; then
	INTERPRETER="$INTERPRETER -qrrb"
fi

header "Primi language-based smoke tests"
info "Using interpreter: "$(which $INTERPRETER)

$INTERPRETER ../tests/smoke/examples.phpt
$INTERPRETER ../tests/smoke/uglies.phpt
