#!/bin/bash -e

cd $(dirname $0)

function info {
	echo "█ "$1
}

function header {
	echo -e "${CLR_GREEN}▄${CLR_RESET}"
	echo -e "${CLR_GREEN}█${CLR_RESET} $1"
	echo -e "${CLR_GREEN}▀${CLR_RESET}"
}

INTERPRETER='php'

POSITIONAL=()
while [[ $# -gt 0 ]]; do
    key="$1"

    case $key in
        --php)
        INTERPRETER="$2"
        shift # past argument
        shift # past value
        ;;
        *)    # unknown option
        POSITIONAL+=("$1") # save it in an array for later
        shift # past argument
        ;;
    esac
done
set -- "${POSITIONAL[@]}" # restore positional parameters

# If the interpreter is phpdbg, we need to add "-qrr" arguments to actually
# run the files.
# https://www.php.net/manual/en/intro.phpdbg.php
if [[ "$INTERPRETER" =~ 'phpdbg' ]]; then
	INTERPRETER="$INTERPRETER -qrrb"
fi

header "Primi language-based smoke tests"
info "Using interpreter: "$(which $INTERPRETER)

$INTERPRETER ../tests/smoke/examples.phpt
$INTERPRETER ../tests/smoke/uglies.phpt
